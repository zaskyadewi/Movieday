DROP TABLE IF EXISTS BookedSeats, Bookings, Showtimes, Users, Movies, Cinemas, Cities;

-- Kota
CREATE TABLE Cities (
  city_id INT AUTO_INCREMENT PRIMARY KEY,
  city_name VARCHAR(100) NOT NULL UNIQUE
);

-- Bioskop
CREATE TABLE Cinemas (
  cinema_id INT AUTO_INCREMENT PRIMARY KEY,
  city_id INT NOT NULL,
  cinema_name VARCHAR(150) NOT NULL,
  address TEXT,
  FOREIGN KEY (city_id) REFERENCES Cities(city_id) ON DELETE CASCADE
);

-- Film
CREATE TABLE Movies (
  movie_id INT AUTO_INCREMENT PRIMARY KEY,
  title VARCHAR(255) NOT NULL,
  synopsis TEXT,
  poster_url VARCHAR(255),
  duration_minutes INT,
  release_date DATE,
  rating VARCHAR(10),
  status VARCHAR(20) DEFAULT 'upcoming',
  price DECIMAL(10, 2) NOT NULL,
  trailer_url VARCHAR(255)
);

-- User
CREATE TABLE Users (
  user_id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(150) NOT NULL,
  email VARCHAR(100) NOT NULL UNIQUE,
  password_hash VARCHAR(255) NOT NULL
);

-- Jadwal Tayang
CREATE TABLE Showtimes (
  showtime_id INT AUTO_INCREMENT PRIMARY KEY,
  movie_id INT NOT NULL,
  cinema_id INT NOT NULL,
  show_datetime DATETIME NOT NULL,
  FOREIGN KEY (movie_id) REFERENCES Movies(movie_id) ON DELETE CASCADE,
  FOREIGN KEY (cinema_id) REFERENCES Cinemas(cinema_id) ON DELETE CASCADE,
  UNIQUE (movie_id, cinema_id, show_datetime)
);

-- Pemesanan
CREATE TABLE Bookings (
  booking_id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  showtime_id INT NOT NULL,
  booking_code VARCHAR(20) NOT NULL UNIQUE,
  total_tickets INT NOT NULL,
  total_price DECIMAL(10, 2) NOT NULL,
  payment_status VARCHAR(20) DEFAULT 'pending',
  booking_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES Users(user_id),
  FOREIGN KEY (showtime_id) REFERENCES Showtimes(showtime_id)
);

-- Kursi
CREATE TABLE BookedSeats (
  booked_seat_id INT AUTO_INCREMENT PRIMARY KEY,
  booking_id INT NOT NULL,
  showtime_id INT NOT NULL,
  seat_row CHAR(1) NOT NULL,
  seat_number INT NOT NULL,
  FOREIGN KEY (booking_id) REFERENCES Bookings(booking_id) ON DELETE CASCADE,
  FOREIGN KEY (showtime_id) REFERENCES Showtimes(showtime_id) ON DELETE CASCADE,
  UNIQUE (showtime_id, seat_row, seat_number)
);

-- Data kota
INSERT INTO Cities (city_name) VALUES ('Jakarta'), ('Bandung'), ('Malang');

-- Data bioskop (3/kota)
INSERT INTO Cinemas (city_id, cinema_name, address) VALUES
  (1, 'Movieday Grand Indonesia', 'Jl. MH Thamrin No.1'),
  (1, 'Movieday Plaza Senayan', 'Jl. Asia Afrika No.8'),
  (1, 'Movieday Kemang Village', 'Jl. Kemang Raya No.20'),
  (2, 'Movieday PVJ', 'Jl. Sukajadi No.131'),
  (2, 'Movieday Ciwalk', 'Jl. Cihampelas No.160'),
  (2, 'Movieday Trans Studio Mall', 'Jl. Gatot Subroto No.289'),
  (3, 'Movieday Matos', 'Jl. Veteran No.2'),
  (3, 'Movieday Dieng', 'Jl. DI Panjaitan No.120'),
  (3, 'Movieday Cyber Mall', 'Jl. Raya Langsep No.23');

-- Data film
-- Film 1
(1,1,'2025-07-01 10:00:00'),(1,1,'2025-07-01 13:00:00'),(1,1,'2025-07-01 16:00:00'),(1,1,'2025-07-01 19:00:00'),
(1,2,'2025-07-01 10:00:00'),(1,2,'2025-07-01 13:00:00'),(1,2,'2025-07-01 16:00:00'),(1,2,'2025-07-01 19:00:00'),
(1,3,'2025-07-01 10:00:00'),(1,3,'2025-07-01 13:00:00'),(1,3,'2025-07-01 16:00:00'),(1,3,'2025-07-01 19:00:00'),
(1,4,'2025-07-01 10:00:00'),(1,4,'2025-07-01 13:00:00'),(1,4,'2025-07-01 16:00:00'),(1,4,'2025-07-01 19:00:00'),
(1,5,'2025-07-01 10:00:00'),(1,5,'2025-07-01 13:00:00'),(1,5,'2025-07-01 16:00:00'),(1,5,'2025-07-01 19:00:00'),
(1,6,'2025-07-01 10:00:00'),(1,6,'2025-07-01 13:00:00'),(1,6,'2025-07-01 16:00:00'),(1,6,'2025-07-01 19:00:00'),
(1,7,'2025-07-01 10:00:00'),(1,7,'2025-07-01 13:00:00'),(1,7,'2025-07-01 16:00:00'),(1,7,'2025-07-01 19:00:00'),
(1,8,'2025-07-01 10:00:00'),(1,8,'2025-07-01 13:00:00'),(1,8,'2025-07-01 16:00:00'),(1,8,'2025-07-01 19:00:00'),
(1,9,'2025-07-01 10:00:00'),(1,9,'2025-07-01 13:00:00'),(1,9,'2025-07-01 16:00:00'),(1,9,'2025-07-01 19:00:00');
-- Film 2
(2,1,'2025-07-01 10:00:00'),(2,1,'2025-07-01 13:00:00'),(2,1,'2025-07-01 16:00:00'),(2,1,'2025-07-01 19:00:00'),
(2,2,'2025-07-01 10:00:00'),(2,2,'2025-07-01 13:00:00'),(2,2,'2025-07-01 16:00:00'),(2,2,'2025-07-01 19:00:00'),
(2,3,'2025-07-01 10:00:00'),(2,3,'2025-07-01 13:00:00'),(2,3,'2025-07-01 16:00:00'),(2,3,'2025-07-01 19:00:00'),
(2,4,'2025-07-01 10:00:00'),(2,4,'2025-07-01 13:00:00'),(2,4,'2025-07-01 16:00:00'),(2,4,'2025-07-01 19:00:00'),
(2,5,'2025-07-01 10:00:00'),(2,5,'2025-07-01 13:00:00'),(2,5,'2025-07-01 16:00:00'),(2,5,'2025-07-01 19:00:00'),
(2,6,'2025-07-01 10:00:00'),(2,6,'2025-07-01 13:00:00'),(2,6,'2025-07-01 16:00:00'),(2,6,'2025-07-01 19:00:00'),
(2,7,'2025-07-01 10:00:00'),(2,7,'2025-07-01 13:00:00'),(2,7,'2025-07-01 16:00:00'),(2,7,'2025-07-01 19:00:00'),
(2,8,'2025-07-01 10:00:00'),(2,8,'2025-07-01 13:00:00'),(2,8,'2025-07-01 16:00:00'),(2,8,'2025-07-01 19:00:00'),
(2,9,'2025-07-01 10:00:00'),(2,9,'2025-07-01 13:00:00'),(2,9,'2025-07-01 16:00:00'),(2,9,'2025-07-01 19:00:00');
-- Film 1
(3,1,'2025-07-01 10:00:00'),(3,1,'2025-07-01 13:00:00'),(3,1,'2025-07-01 16:00:00'),(3,1,'2025-07-01 19:00:00'),
(3,2,'2025-07-01 10:00:00'),(3,2,'2025-07-01 13:00:00'),(3,2,'2025-07-01 16:00:00'),(3,2,'2025-07-01 19:00:00'),
(3,3,'2025-07-01 10:00:00'),(3,3,'2025-07-01 13:00:00'),(3,3,'2025-07-01 16:00:00'),(3,3,'2025-07-01 19:00:00'),
(3,4,'2025-07-01 10:00:00'),(3,4,'2025-07-01 13:00:00'),(3,4,'2025-07-01 16:00:00'),(3,4,'2025-07-01 19:00:00'),
(3,5,'2025-07-01 10:00:00'),(3,5,'2025-07-01 13:00:00'),(3,5,'2025-07-01 16:00:00'),(3,5,'2025-07-01 19:00:00'),
(3,6,'2025-07-01 10:00:00'),(3,6,'2025-07-01 13:00:00'),(3,6,'2025-07-01 16:00:00'),(3,6,'2025-07-01 19:00:00'),
(3,7,'2025-07-01 10:00:00'),(3,7,'2025-07-01 13:00:00'),(3,7,'2025-07-01 16:00:00'),(3,7,'2025-07-01 19:00:00'),
(3,8,'2025-07-01 10:00:00'),(3,8,'2025-07-01 13:00:00'),(3,8,'2025-07-01 16:00:00'),(3,8,'2025-07-01 19:00:00'),
(3,9,'2025-07-01 10:00:00'),(3,9,'2025-07-01 13:00:00'),(3,9,'2025-07-01 16:00:00'),(3,9,'2025-07-01 19:00:00');
-- Film 4
(4,1,'2025-07-04 10:00:00'),(4,1,'2025-07-04 13:00:00'),(4,1,'2025-07-04 16:00:00'),(4,1,'2025-07-04 19:00:00'),
(4,2,'2025-07-04 10:00:00'),(4,2,'2025-07-04 13:00:00'),(4,2,'2025-07-04 16:00:00'),(4,2,'2025-07-04 19:00:00'),
(4,3,'2025-07-04 10:00:00'),(4,3,'2025-07-04 13:00:00'),(4,3,'2025-07-04 16:00:00'),(4,3,'2025-07-04 19:00:00'),
(4,4,'2025-07-04 10:00:00'),(4,4,'2025-07-04 13:00:00'),(4,4,'2025-07-04 16:00:00'),(4,4,'2025-07-04 19:00:00'),
(4,5,'2025-07-04 10:00:00'),(4,5,'2025-07-04 13:00:00'),(4,5,'2025-07-04 16:00:00'),(4,5,'2025-07-04 19:00:00'),
(4,6,'2025-07-04 10:00:00'),(4,6,'2025-07-04 13:00:00'),(4,6,'2025-07-04 16:00:00'),(4,6,'2025-07-04 19:00:00'),
(4,7,'2025-07-04 10:00:00'),(4,7,'2025-07-04 13:00:00'),(4,7,'2025-07-04 16:00:00'),(4,7,'2025-07-04 19:00:00'),
(4,8,'2025-07-04 10:00:00'),(4,8,'2025-07-04 13:00:00'),(4,8,'2025-07-04 16:00:00'),(4,8,'2025-07-04 19:00:00'),
(4,9,'2025-07-04 10:00:00'),(4,9,'2025-07-04 13:00:00'),(4,9,'2025-07-04 16:00:00'),(4,9,'2025-07-04 19:00:00'),
-- Film 5
(5,1,'2025-07-05 10:00:00'),(5,1,'2025-07-05 13:00:00'),(5,1,'2025-07-05 16:00:00'),(5,1,'2025-07-05 19:00:00'),
(5,2,'2025-07-05 10:00:00'),(5,2,'2025-07-05 13:00:00'),(5,2,'2025-07-05 16:00:00'),(5,2,'2025-07-05 19:00:00'),
(5,3,'2025-07-05 10:00:00'),(5,3,'2025-07-05 13:00:00'),(5,3,'2025-07-05 16:00:00'),(5,3,'2025-07-05 19:00:00'),
(5,4,'2025-07-05 10:00:00'),(5,4,'2025-07-05 13:00:00'),(5,4,'2025-07-05 16:00:00'),(5,4,'2025-07-05 19:00:00'),
(5,5,'2025-07-05 10:00:00'),(5,5,'2025-07-05 13:00:00'),(5,5,'2025-07-05 16:00:00'),(5,5,'2025-07-05 19:00:00'),
(5,6,'2025-07-05 10:00:00'),(5,6,'2025-07-05 13:00:00'),(5,6,'2025-07-05 16:00:00'),(5,6,'2025-07-05 19:00:00'),
(5,7,'2025-07-05 10:00:00'),(5,7,'2025-07-05 13:00:00'),(5,7,'2025-07-05 16:00:00'),(5,7,'2025-07-05 19:00:00'),
(5,8,'2025-07-05 10:00:00'),(5,8,'2025-07-05 13:00:00'),(5,8,'2025-07-05 16:00:00'),(5,8,'2025-07-05 19:00:00'),
(5,9,'2025-07-05 10:00:00'),(5,9,'2025-07-05 13:00:00'),(5,9,'2025-07-05 16:00:00'),(5,9,'2025-07-05 19:00:00'),
-- Film 6
(6,1,'2025-07-06 10:00:00'),(6,1,'2025-07-06 13:00:00'),(6,1,'2025-07-06 16:00:00'),(6,1,'2025-07-06 19:00:00'),
(6,2,'2025-07-06 10:00:00'),(6,2,'2025-07-06 13:00:00'),(6,2,'2025-07-06 16:00:00'),(6,2,'2025-07-06 19:00:00'),
(6,3,'2025-07-06 10:00:00'),(6,3,'2025-07-06 13:00:00'),(6,3,'2025-07-06 16:00:00'),(6,3,'2025-07-06 19:00:00'),
(6,4,'2025-07-06 10:00:00'),(6,4,'2025-07-06 13:00:00'),(6,4,'2025-07-06 16:00:00'),(6,4,'2025-07-06 19:00:00'),
(6,5,'2025-07-06 10:00:00'),(6,5,'2025-07-06 13:00:00'),(6,5,'2025-07-06 16:00:00'),(6,5,'2025-07-06 19:00:00'),
(6,6,'2025-07-06 10:00:00'),(6,6,'2025-07-06 13:00:00'),(6,6,'2025-07-06 16:00:00'),(6,6,'2025-07-06 19:00:00'),
(6,7,'2025-07-06 10:00:00'),(6,7,'2025-07-06 13:00:00'),(6,7,'2025-07-06 16:00:00'),(6,7,'2025-07-06 19:00:00'),
(6,8,'2025-07-06 10:00:00'),(6,8,'2025-07-06 13:00:00'),(6,8,'2025-07-06 16:00:00'),(6,8,'2025-07-06 19:00:00'),
(6,9,'2025-07-06 10:00:00'),(6,9,'2025-07-06 13:00:00'),(6,9,'2025-07-06 16:00:00'),(6,9,'2025-07-06 19:00:00'),
-- Film 7
(7,1,'2025-07-06 10:00:00'),(7,1,'2025-07-06 13:00:00'),(7,1,'2025-07-06 16:00:00'),(7,1,'2025-07-06 19:00:00'),
(7,2,'2025-07-06 10:00:00'),(7,2,'2025-07-06 13:00:00'),(7,2,'2025-07-06 16:00:00'),(7,2,'2025-07-06 19:00:00'),
(7,3,'2025-07-06 10:00:00'),(7,3,'2025-07-06 13:00:00'),(7,3,'2025-07-06 16:00:00'),(7,3,'2025-07-06 19:00:00'),
(7,4,'2025-07-06 10:00:00'),(7,4,'2025-07-06 13:00:00'),(7,4,'2025-07-06 16:00:00'),(7,4,'2025-07-06 19:00:00'),
(7,5,'2025-07-06 10:00:00'),(7,5,'2025-07-06 13:00:00'),(7,5,'2025-07-06 16:00:00'),(7,5,'2025-07-06 19:00:00'),
(7,6,'2025-07-06 10:00:00'),(7,6,'2025-07-06 13:00:00'),(7,6,'2025-07-06 16:00:00'),(7,6,'2025-07-06 19:00:00'),
(7,7,'2025-07-06 10:00:00'),(7,7,'2025-07-06 13:00:00'),(7,7,'2025-07-06 16:00:00'),(7,7,'2025-07-06 19:00:00'),
(7,8,'2025-07-06 10:00:00'),(7,8,'2025-07-06 13:00:00'),(7,8,'2025-07-06 16:00:00'),(7,8,'2025-07-06 19:00:00'),
(7,9,'2025-07-06 10:00:00'),(7,9,'2025-07-06 13:00:00'),(7,9,'2025-07-06 16:00:00'),(7,9,'2025-07-06 19:00:00'),
-- Film 8
(8,1,'2025-07-06 10:00:00'),(8,1,'2025-07-06 13:00:00'),(8,1,'2025-07-06 16:00:00'),(8,1,'2025-07-06 19:00:00'),
(8,2,'2025-07-06 10:00:00'),(8,2,'2025-07-06 13:00:00'),(8,2,'2025-07-06 16:00:00'),(8,2,'2025-07-06 19:00:00'),
(8,3,'2025-07-06 10:00:00'),(8,3,'2025-07-06 13:00:00'),(8,3,'2025-07-06 16:00:00'),(8,3,'2025-07-06 19:00:00'),
(8,4,'2025-07-06 10:00:00'),(8,4,'2025-07-06 13:00:00'),(8,4,'2025-07-06 16:00:00'),(8,4,'2025-07-06 19:00:00'),
(8,5,'2025-07-06 10:00:00'),(8,5,'2025-07-06 13:00:00'),(8,5,'2025-07-06 16:00:00'),(8,5,'2025-07-06 19:00:00'),
(8,6,'2025-07-06 10:00:00'),(8,6,'2025-07-06 13:00:00'),(8,6,'2025-07-06 16:00:00'),(8,6,'2025-07-06 19:00:00'),
(8,7,'2025-07-06 10:00:00'),(8,7,'2025-07-06 13:00:00'),(8,7,'2025-07-06 16:00:00'),(8,7,'2025-07-06 19:00:00'),
(8,8,'2025-07-06 10:00:00'),(8,8,'2025-07-06 13:00:00'),(8,8,'2025-07-06 16:00:00'),(8,8,'2025-07-06 19:00:00'),
(8,9,'2025-07-06 10:00:00'),(8,9,'2025-07-06 13:00:00'),(8,9,'2025-07-06 16:00:00'),(8,9,'2025-07-06 19:00:00')
